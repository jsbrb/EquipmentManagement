<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Mapa de Obras</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>

<div id="map" style="height: 500px;"></div>

<script th:inline="javascript">
    /*<![CDATA[*/
    const works = /*[[${works}]]*/ [];
    const equipmentByWork = /*[[${equipmentByWork}]]*/ {};
    /*]]>*/
</script>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const map = L.map('map').setView([39.4699, -0.3763], 13); // Valencia por defecto

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    works.forEach(work => {
        if (work.latitude && work.longitude) {
            const marker = L.marker([work.latitude, work.longitude]).addTo(map);
            let popupContent = `<strong>${work.name}</strong><br/>`;

            // AÃ±adir herramientas vinculadas a la obra, si hay
            const equipments = equipmentByWork[work.id];
            if (equipments && equipments.length > 0) {
                popupContent += '<ul>';
                equipments.forEach(eq => {
                    popupContent += `<li>${eq.name}</li>`;
                });
                popupContent += '</ul>';
            }

            marker.bindPopup(popupContent);
        }
    });
</script>

</body>
</html>
